<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CardÃ¡pio Digital</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { box-sizing: border-box; }
    * { scrollbar-width: thin; scrollbar-color: #d97706 #1a1a1a; }
    .menu-item { transition: all 0.25s ease; cursor: pointer; }
    .menu-item:hover { transform: translateY(-2px); border-color: rgba(217,119,6,.55) !important; }
    .badge { animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.85} }
    .whatsapp-btn { animation: bounce 2s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }
    .modal-overlay{ position: fixed; inset: 0; background: rgba(0,0,0,.75); display: none; align-items: center; justify-content: center; z-index: 3000; padding: 16px; }
    .modal-overlay.active{ display: flex; }
    .modal-content{ width: 100%; max-width: 900px; border-radius: 18px; background: linear-gradient(135deg, #262626 0%, #1f1f1f 100%); border: 1px solid #404040; box-shadow: 0 20px 60px rgba(0,0,0,.5); }
    .cart-fab{ position: fixed; right: 16px; bottom: 100px; z-index: 2500; display: none; align-items: center; gap: 10px; padding: 12px 14px; border-radius: 999px; background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color: #1a1a1a; font-weight: 800; box-shadow: 0 14px 30px rgba(217,119,6,.25); cursor: pointer; user-select: none; }
    .cart-badge{ min-width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center; border-radius: 999px; background: rgba(26,26,26,.92); color: #fef3c7; font-weight: 800; padding: 0 8px; }
    .category-icon { transition: transform 0.3s ease; }
    .category-header:hover .category-icon { transform: scale(1.1); }
  </style>
</head>

<body class="h-full">
  <div class="h-full w-full overflow-auto" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);">

    <header class="relative overflow-hidden" style="background: linear-gradient(135deg, #b91c1c 0%, #991b1b 50%, #7f1d1d 100%);">
      <div class="relative px-6 py-8 text-center">
        <h1 class="text-3xl md:text-4xl font-bold mb-2" style="font-family:'Playfair Display',serif;color:#fef3c7;">Sabor &amp; Arte</h1>
        <p class="text-lg opacity-90" style="font-family:'Poppins',sans-serif;color:#fde68a;">Sabor que conquista no primeiro pedido</p>

        <div class="mt-6 inline-block px-6 py-3 rounded-full" style="background: linear-gradient(135deg, #d97706 0%, #b45309 100%); box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3);">
          <p class="text-sm font-semibold" style="font-family:'Poppins',sans-serif;color:#1a1a1a;">
            ğŸ”¥ PromoÃ§Ã£o do Dia: 20% OFF em todos os lanches!
          </p>
        </div>
      </div>
    </header>

    <main class="px-4 py-6 max-w-2xl mx-auto" style="font-family:'Poppins',sans-serif;">

      <!-- Se nÃ£o tiver produtos -->
      <div id="empty-menu" class="hidden p-6 rounded-xl text-center mb-6"
           style="background:linear-gradient(135deg,#262626 0%,#1f1f1f 100%);border:1px solid #404040;">
        <p class="text-lg font-bold" style="color:#fde68a;">Ainda nÃ£o hÃ¡ produtos cadastrados.</p>
        <p class="text-sm mt-1" style="color:#d6d3d1;">O restaurante vai atualizar em instantes.</p>
      </div>

      <!-- Aqui entram as categorias automaticamente -->
      <div id="menu-root" class="space-y-8"></div>

      <!-- CTA WhatsApp -->
      <div class="sticky bottom-4 z-50 px-4 mt-10">
        <a id="whatsapp-btn"
           href="https://wa.me/5511999999999?text=OlÃ¡! Gostaria de fazer um pedido"
           target="_blank" rel="noopener noreferrer"
           class="whatsapp-btn block w-full py-4 rounded-full text-center font-bold text-lg shadow-lg"
           style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);">
          ğŸ“² PeÃ§a agora pelo WhatsApp
        </a>

        <!-- Jogo (abre em nova aba â€“ iframe pode bloquear) -->
        <button id="btn-game" class="mt-3 w-full py-3 rounded-full font-extrabold"
                style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color:#0b1020;">
          ğŸ® Jogar Subway Surfers (abrir)
        </button>
      </div>

      <footer class="mt-8 pb-24 text-center">
        <div class="py-6 rounded-xl mx-4" style="background: linear-gradient(135deg, #262626 0%, #1f1f1f 100%); border: 1px solid #404040;">
          <p class="text-sm opacity-80" style="color: #d6d3d1;">ğŸ“ Delivery e Retirada</p>
          <p class="text-sm mt-1 opacity-60" style="color: #d6d3d1;">Seg a Dom: 11h Ã s 23h</p>
          <p class="text-xs mt-3 opacity-40" style="color: #d6d3d1;">Aceitamos CartÃ£o, Dinheiro e Pix</p>
        </div>
      </footer>
    </main>

    <!-- BotÃ£o carrinho -->
    <div id="cart-btn" class="cart-fab" onclick="openCart()">
      ğŸ›’ Carrinho <span id="cart-count" class="cart-badge">0</span>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="modal-overlay">
      <div class="modal-content p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold" style="color:#d97706; font-family:'Playfair Display',serif;">Seu Carrinho ğŸ›’</h2>
          <button onclick="closeCart()" class="text-3xl" style="color:#d6d3d1;">Ã—</button>
        </div>

        <div id="cart-items" class="space-y-3 mb-6"></div>

        <div class="border-t pt-4 mb-6" style="border-color:#404040;">
          <div class="flex justify-between items-center mb-2">
            <span class="text-lg" style="color:#d6d3d1;">Subtotal:</span>
            <span id="cart-total" class="text-2xl font-bold" style="color:#d97706;">R$ 0,00</span>
          </div>
        </div>

        <button onclick="openCheckout()" class="w-full py-4 rounded-xl font-bold text-lg"
                style="background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color: #1a1a1a;">
          Finalizar Pedido ğŸ¯
        </button>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="modal-overlay">
      <div class="modal-content p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold" style="color:#d97706; font-family:'Playfair Display',serif;">Dados de Entrega ğŸ“</h2>
          <button onclick="closeCheckout()" class="text-3xl" style="color:#d6d3d1;">Ã—</button>
        </div>

        <form id="checkout-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Nome Completo</label>
            <input type="text" id="customer-name" required class="w-full px-4 py-3 rounded-lg"
                   style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="Seu nome">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Telefone</label>
            <input type="tel" id="customer-phone" required class="w-full px-4 py-3 rounded-lg"
                   style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="(11) 99999-9999">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">CEP</label>
            <input type="text" id="customer-cep" required maxlength="9" class="w-full px-4 py-3 rounded-lg"
                   style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="00000-000">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">EndereÃ§o</label>
            <input type="text" id="customer-address" required class="w-full px-4 py-3 rounded-lg"
                   style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="Rua, nÃºmero">
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Bairro</label>
              <input type="text" id="customer-neighborhood" required class="w-full px-4 py-3 rounded-lg"
                     style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="Bairro">
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Cidade</label>
              <input type="text" id="customer-city" required class="w-full px-4 py-3 rounded-lg"
                     style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="Cidade">
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Complemento (Opcional)</label>
            <input type="text" id="customer-complement" class="w-full px-4 py-3 rounded-lg"
                   style="background:#1a1a1a; border:1px solid #404040; color:#fef3c7;" placeholder="Apto, bloco...">
          </div>

          <button type="submit" class="w-full py-4 rounded-xl font-bold text-lg"
                  style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white;">
            Enviar Pedido ğŸ“²
          </button>
        </form>
      </div>
    </div>

    <div id="success-modal" class="modal-overlay">
      <div class="modal-content p-8 text-center">
        <div class="text-8xl mb-4">âœ…</div>
        <h2 class="text-3xl font-bold mb-3" style="color:#22c55e; font-family:'Playfair Display',serif;">Pedido Pronto pra Enviar!</h2>
        <p class="text-lg mb-6" style="color:#d6d3d1;">Abriremos o WhatsApp para vocÃª confirmar e enviar. ğŸ‰</p>
        <button onclick="closeSuccess()" class="text-sm" style="color:#d6d3d1;">Voltar ao cardÃ¡pio</button>
      </div>
    </div>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBqFZJ5wg3VIJlJtA4DgFS499_9rXu-zAk",
      authDomain: "cardapio-digital-adc3d.firebaseapp.com",
      projectId: "cardapio-digital-adc3d",
      storageBucket: "cardapio-digital-adc3d.firebasestorage.app",
      messagingSenderId: "762370492160",
      appId: "1:762370492160:web:86a86687c52a76f56895e5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Abrir jogo (fallback novo tab)
    document.getElementById("btn-game").addEventListener("click", ()=>{
      window.open("https://poki.com/br/g/subway-surfers", "_blank", "noopener,noreferrer");
    });

    // ======= CARDÃPIO DINÃ‚MICO (products) =======
    const menuRoot = document.getElementById("menu-root");
    const emptyMenu = document.getElementById("empty-menu");

    const categoryMeta = {
      "Lanches": { icon:"ğŸ”" },
      "Pizzas": { icon:"ğŸ•" },
      "Pratos Principais": { icon:"ğŸ" },
      "Bebidas": { icon:"ğŸ¥¤" },
      "Sobremesas": { icon:"ğŸ°" }
    };

    function money(v){ return `R$ ${Number(v||0).toFixed(2)}`; }

    function renderMenu(products){
      if(!products.length){
        emptyMenu.classList.remove("hidden");
        menuRoot.innerHTML = "";
        return;
      }
      emptyMenu.classList.add("hidden");

      // agrupa por categoria
      const groups = {};
      products.forEach(p=>{
        const cat = p.category || "Outros";
        if(!groups[cat]) groups[cat] = [];
        groups[cat].push(p);
      });

      // ordena categorias na ordem desejada
      const orderedCats = ["Lanches","Pizzas","Pratos Principais]()

<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card√°pio Digital</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { box-sizing: border-box; }
    * { scrollbar-width: thin; scrollbar-color: #d97706 #1a1a1a; }

    .menu-item { transition: all 0.25s ease; cursor: pointer; }
    .menu-item:hover { transform: translateY(-2px); border-color: rgba(217,119,6,.55) !important; }

    .badge { animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.85} }

    .whatsapp-btn { animation: bounce 2s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }

    .delivery-animation { position: relative; height: 50px; }

    .modal-overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      padding: 16px;
    }
    .modal-overlay.active{ display: flex; }

    .modal-content{
      width: 100%;
      max-width: 920px;
      border-radius: 18px;
      background: linear-gradient(135deg, #262626 0%, #1f1f1f 100%);
      border: 1px solid #404040;
      box-shadow: 0 20px 60px rgba(0,0,0,.5);
    }

    .game-frame{
      width: 100%;
      height: 72vh;
      max-height: 560px;
      border: 0;
      border-radius: 14px;
      background: #000;
    }

    .cart-fab{
      position: fixed;
      right: 16px;
      bottom: 100px;
      z-index: 2500;
      display: none;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 999px;
      background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
      color: #1a1a1a;
      font-weight: 800;
      box-shadow: 0 14px 30px rgba(217,119,6,.25);
      cursor: pointer;
      user-select: none;
    }
    .cart-badge{
      min-width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 999px;
      background: rgba(26,26,26,.92);
      color: #fef3c7;
      font-weight: 800;
      padding: 0 8px;
    }

    .input {
      width:100%;
      background:#1a1a1a;
      border:1px solid #404040;
      color:#fef3c7;
      border-radius: 12px;
      padding: 12px 14px;
    }
  </style>
</head>

<body class="h-full">
  <div id="app-wrapper" class="h-full w-full overflow-auto"
       style="background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);">

    <!-- Header -->
    <header class="relative overflow-hidden"
            style="background: linear-gradient(135deg, #b91c1c 0%, #991b1b 50%, #7f1d1d 100%);">
      <div class="absolute inset-0 opacity-10">
        <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
          <pattern id="pattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
            <circle cx="10" cy="10" r="1" fill="#d97706" />
          </pattern>
          <rect width="100%" height="100%" fill="url(#pattern)" />
        </svg>
      </div>

      <div class="relative px-6 py-8 text-center">
        <div class="mb-4 flex justify-center">
          <div class="w-20 h-20 rounded-full flex items-center justify-center"
               style="background: linear-gradient(135deg, #d97706 0%, #b45309 100%); box-shadow: 0 4px 20px rgba(217, 119, 6, 0.4);">
            <svg class="w-10 h-10" fill="#1a1a1a" viewBox="0 0 24 24">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" />
            </svg>
          </div>
        </div>

        <h1 id="restaurant-name" class="text-3xl md:text-4xl font-bold mb-2"
            style="font-family:'Playfair Display',serif;color:#fef3c7;">Sabor &amp; Arte</h1>
        <p id="slogan" class="text-lg opacity-90"
           style="font-family:'Poppins',sans-serif;color:#fde68a;">Sabor que conquista no primeiro pedido</p>

        <div class="mt-6 flex flex-col md:flex-row items-center justify-center gap-3">
          <div class="inline-block px-6 py-3 rounded-full"
               style="background: linear-gradient(135deg, #d97706 0%, #b45309 100%); box-shadow: 0 4px 15px rgba(217, 119, 6, 0.3);">
            <p class="text-sm font-semibold" style="font-family:'Poppins',sans-serif;color:#1a1a1a;">
              üî• <span id="promo-title">Promo√ß√£o do Dia</span>: <span id="promo-description">Confira as ofertas!</span>
            </p>
          </div>

          <button id="btn-open-game"
            class="px-6 py-3 rounded-full font-extrabold"
            style="background:linear-gradient(135deg,#3b82f6 0%,#1d4ed8 100%); color:#0b1020; box-shadow:0 4px 15px rgba(59,130,246,.25);">
            üéÆ Jogar Subway Surfers
          </button>
        </div>
      </div>
    </header>
<!-- GAME CTA -->
<div class="mt-6 px-4">
  <button onclick="openGame()"
    class="w-full py-4 rounded-2xl font-extrabold text-lg shadow-lg"
    style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color:#1a1a1a;">
    üéÆ Jogar Subway (enquanto espera)
  </button>
  <p class="text-xs text-center mt-2" style="color:#9ca3af;">
    Dica: se n√£o abrir aqui dentro, a gente abre em nova aba automaticamente.
  </p>
</div>

    <main class="px-4 py-6 max-w-2xl mx-auto" style="font-family:'Poppins',sans-serif;">

      <!-- Status carregamento -->
      <div id="loading" class="rounded-xl p-4 text-center mb-6"
           style="background:#111; border:1px solid #333; color:#fde68a;">
        Carregando card√°pio...
      </div>

      <!-- Aqui entram as categorias din√¢micas -->
      <div id="menu-root"></div>

      <!-- WhatsApp CTA -->
      <div class="sticky bottom-4 z-50 px-4 mt-8">
        <div class="delivery-animation mb-3 flex items-center justify-center gap-2">
          <span class="text-4xl">üèçÔ∏è</span>
          <span class="text-3xl">üßë‚Äçüç≥</span>
          <span class="text-3xl">üì¶</span>
          <span class="text-2xl">‚ú®</span>
        </div>

        <a id="whatsapp-btn"
           href="#"
           target="_blank" rel="noopener noreferrer"
           class="whatsapp-btn block w-full py-4 rounded-full text-center font-bold text-lg shadow-lg"
           style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);">
          üì≤ Pe√ßa agora pelo WhatsApp
        </a>
      </div>

      <!-- Footer -->
      <footer class="mt-8 pb-24 text-center">
        <div class="py-6 rounded-xl mx-4"
             style="background: linear-gradient(135deg, #262626 0%, #1f1f1f 100%); border: 1px solid #404040;">
          <p class="text-sm opacity-80" style="color: #d6d3d1;">üìç Delivery e Retirada</p>
          <p class="text-sm mt-1 opacity-60" style="color: #d6d3d1;">Seg a Dom: 11h √†s 23h</p>
          <div class="flex justify-center gap-4 mt-4">
            <span class="text-2xl">üí≥</span><span class="text-2xl">üíµ</span><span class="text-2xl">üì±</span>
          </div>
          <p class="text-xs mt-3 opacity-40" style="color: #d6d3d1;">Aceitamos Cart√£o, Dinheiro e Pix</p>
        </div>
      </footer>
    </main>

    <!-- Floating cart button -->
    <div id="cart-btn" class="cart-fab" onclick="openCart()">
      üõí Carrinho <span id="cart-count" class="cart-badge">0</span>
    </div>

    <!-- Cart Modal -->
    <div id="cart-modal" class="modal-overlay">
      <div class="modal-content p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold" style="color:#d97706; font-family:'Playfair Display',serif;">Seu Carrinho üõí</h2>
          <button onclick="closeCart()" class="text-3xl" style="color:#d6d3d1;">√ó</button>
        </div>

        <div id="cart-items" class="space-y-3 mb-6"></div>

        <div class="border-t pt-4 mb-6" style="border-color:#404040;">
          <div class="flex justify-between items-center mb-2">
            <span class="text-lg" style="color:#d6d3d1;">Subtotal:</span>
            <span id="cart-total" class="text-2xl font-bold" style="color:#d97706;">R$ 0,00</span>
          </div>
        </div>

        <button onclick="openCheckout()" class="w-full py-4 rounded-xl font-bold text-lg"
                style="background: linear-gradient(135deg, #d97706 0%, #b45309 100%); color: #1a1a1a;">
          Finalizar Pedido üéØ
        </button>
      </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="modal-overlay">
      <div class="modal-content p-6">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold" style="color:#d97706; font-family:'Playfair Display',serif;">Dados de Entrega üìç</h2>
          <button onclick="closeCheckout()" class="text-3xl" style="color:#d6d3d1;">√ó</button>
        </div>

        <form id="checkout-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Nome Completo</label>
            <input type="text" id="customer-name" required class="input" placeholder="Seu nome">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Telefone</label>
            <input type="tel" id="customer-phone" required class="input" placeholder="(11) 99999-9999">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">CEP</label>
            <input type="text" id="customer-cep" required maxlength="9" class="input" placeholder="00000-000">
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Endere√ßo</label>
            <input type="text" id="customer-address" required class="input" placeholder="Rua, n√∫mero">
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Bairro</label>
              <input type="text" id="customer-neighborhood" required class="input" placeholder="Bairro">
            </div>
            <div>
              <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Cidade</label>
              <input type="text" id="customer-city" required class="input" placeholder="Cidade">
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" style="color:#fef3c7;">Complemento (Opcional)</label>
            <input type="text" id="customer-complement" class="input" placeholder="Apto, bloco...">
          </div>

          <button type="submit" class="w-full py-4 rounded-xl font-bold text-lg"
                  style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white;">
            Enviar Pedido pelo WhatsApp üì≤
          </button>

          <p class="text-xs muted">
            *Seu pedido tamb√©m fica salvo no sistema (admin) automaticamente.
          </p>
        </form>
      </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal-overlay">
      <div class="modal-content p-8 text-center">
        <div class="text-8xl mb-4">‚úÖ</div>
        <h2 class="text-3xl font-bold mb-3" style="color:#22c55e; font-family:'Playfair Display',serif;">Pedido Pronto pra Enviar!</h2>
        <p class="text-lg mb-6" style="color:#d6d3d1;">Abriremos o WhatsApp para voc√™ confirmar e enviar. üéâ</p>

        <div class="mb-6 p-4 rounded-xl" style="background:#1a1a1a; border:1px solid #404040;">
          <p class="text-sm mb-2" style="color:#fef3c7;">Tempo estimado de entrega:</p>
          <p class="text-2xl font-bold" style="color:#d97706;">45min a 1h20 ‚è±Ô∏è</p>
        </div>

        <button onclick="closeSuccess()" class="text-sm" style="color:#d6d3d1;">Voltar ao card√°pio</button>
      </div>
    </div>

    <!-- GAME MODAL -->
    <div id="game-modal" class="modal-overlay">
      <div class="modal-content p-4">
        <div class="flex items-center justify-between gap-3 mb-3">
          <h3 class="text-xl font-extrabold" style="color:#fde68a; font-family:'Playfair Display',serif;">üéÆ Subway Surfers</h3>
          <button id="btn-close-game" class="text-3xl" style="color:#d6d3d1;">√ó</button>
        </div>

        <div class="rounded-xl overflow-hidden border border-neutral-700">
          <!-- ATEN√á√ÉO:
               Alguns sites bloqueiam iframe. Se ficar branco, use o bot√£o "Abrir em nova aba". -->
          <iframe id="game-iframe" class="game-frame"
            src="https://poki.com/br/g/subway-surfers"
            allow="autoplay; fullscreen; gamepad"
            loading="lazy"></iframe>
        </div>

        <div class="mt-3 flex flex-col md:flex-row gap-2">
          <a id="game-open-tab"
             href="https://poki.com/br/g/subway-surfers"
             target="_blank" rel="noopener"
             class="px-4 py-3 rounded-xl font-extrabold text-center"
             style="background:linear-gradient(135deg,#d97706 0%,#b45309 100%); color:#141414;">
            üîó Abrir em nova aba (se n√£o carregar)
          </a>
          <p class="text-xs muted md:self-center">
            Se o jogo n√£o abrir aqui, √© porque o site bloqueia incorpora√ß√£o. A√≠ use o bot√£o acima.
          </p>
        </div>
      </div>
    </div>

  </div>

  <!-- =========================
       SCRIPT √öNICO (FIREBASE + MENU DIN√ÇMICO)
       ========================= -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // SEU CONFIG (igual admin)
    const firebaseConfig = {
      apiKey: "AIzaSyBqFZJ5wg3VIJlJtA4DgFS499_9rXu-zAk",
      authDomain: "cardapio-digital-adc3d.firebaseapp.com",
      projectId: "cardapio-digital-adc3d",
      storageBucket: "cardapio-digital-adc3d.firebasestorage.app",
      messagingSenderId: "762370492160",
      appId: "1:762370492160:web:86a86687c52a76f56895e5"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // =========================
    // CONFIG DO WHATSAPP (coloque o n√∫mero do restaurante aqui)
    // =========================
    const RESTAURANT_WHATSAPP = "5511999999999"; // <-- TROQUE AQUI

    // =========================
    // ESTADO (CARRINHO)
    // =========================
    let cart = [];

    // =========================
    // HELPERS
    // =========================
    const $ = (id) => document.getElementById(id);
    const digits = (v) => String(v||"").replace(/\D/g,"");
    const money = (v) => `R$ ${Number(v||0).toFixed(2).replace(".", ",")}`;

    function escapeHtml(str){
      return String(str || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed; top: 80px; right: 20px;
        background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        color: #1a1a1a; padding: 12px 18px; border-radius: 999px;
        font-weight: 800; z-index: 5000; box-shadow: 0 10px 30px rgba(0,0,0,.35);
      `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2200);
    }

    // =========================
    // CART UI
    // =========================
    function updateCartUI() {
      const cartBtn = $('cart-btn');
      const cartCount = $('cart-count');
      const cartItems = $('cart-items');
      const cartTotal = $('cart-total');

      const totalItems = cart.reduce((s, i) => s + i.quantity, 0);
      const totalPrice = cart.reduce((s, i) => s + i.price * i.quantity, 0);

      if (totalItems > 0) {
        cartBtn.style.display = 'inline-flex';
        cartCount.textContent = totalItems;
      } else {
        cartBtn.style.display = 'none';
      }

      if (cart.length === 0) {
        cartItems.innerHTML = '<p class="text-center py-8" style="color:#d6d3d1;">Seu carrinho est√° vazio</p>';
      } else {
        cartItems.innerHTML = cart.map((item, idx) => `
          <div class="flex items-center gap-3 p-3 rounded-lg" style="background:#1a1a1a; border:1px solid #404040;">
            <span class="text-2xl">${escapeHtml(item.emoji || "üçΩÔ∏è")}</span>
            <div class="flex-1">
              <h4 class="font-semibold" style="color:#fef3c7;">${escapeHtml(item.name)}</h4>
              <p class="text-sm" style="color:#d97706;">${money(item.price)}</p>
            </div>
            <div class="flex items-center gap-2">
              <button data-dec="${idx}" class="w-8 h-8 rounded-full font-bold" style="background:#404040; color:#fef3c7;">-</button>
              <span class="w-8 text-center font-bold" style="color:#fef3c7;">${item.quantity}</span>
              <button data-inc="${idx}" class="w-8 h-8 rounded-full font-bold" style="background:#d97706; color:#1a1a1a;">+</button>
            </div>
            <button data-del="${idx}" class="text-xl" style="color:#ef4444;">üóëÔ∏è</button>
          </div>
        `).join('');

        cartItems.querySelectorAll("button[data-dec]").forEach(b=>{
          b.onclick = () => { const i=Number(b.dataset.dec); cart[i].quantity--; if(cart[i].quantity<=0) cart.splice(i,1); updateCartUI(); };
        });
        cartItems.querySelectorAll("button[data-inc]").forEach(b=>{
          b.onclick = () => { const i=Number(b.dataset.inc); cart[i].quantity++; updateCartUI(); };
        });
        cartItems.querySelectorAll("button[data-del]").forEach(b=>{
          b.onclick = () => { const i=Number(b.dataset.del); cart.splice(i,1); updateCartUI(); };
        });
      }

      cartTotal.textContent = money(totalPrice);
    }

    // a√ß√µes globais
    window.addToCart = function(name, price, emoji){
      const existing = cart.find(i => i.name === name);
      if (existing) existing.quantity++;
      else cart.push({ name, price, emoji, quantity: 1 });
      updateCartUI();
      showToast(`${emoji || "üçΩÔ∏è"} ${name} adicionado!`);
    };

    window.openCart = function(){
      if (cart.length === 0) { showToast('‚ö†Ô∏è Adicione itens ao carrinho primeiro!'); return; }
      $('cart-modal').classList.add('active');
    };
    window.closeCart = function(){ $('cart-modal').classList.remove('active'); };

    window.openCheckout = function(){
      if (cart.length === 0) return;
      window.closeCart();
      $('checkout-modal').classList.add('active');
    };
    window.closeCheckout = function(){ $('checkout-modal').classList.remove('active'); };

    window.closeSuccess = function(){
      $('success-modal').classList.remove('active');
      cart = [];
      updateCartUI();
    };

    // fechar modal clicando fora
    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === this) this.classList.remove('active');
      });
    });

    // =========================
    // GAME
    // =========================
    $('btn-open-game').addEventListener('click', () => $('game-modal').classList.add('active'));
    $('btn-close-game').addEventListener('click', () => $('game-modal').classList.remove('active'));

    // =========================
    // CEP m√°scara
    // =========================
    const cepInput = $('customer-cep');
    if (cepInput) {
      cepInput.addEventListener('input', function(e) {
        let v = e.target.value.replace(/\D/g, '');
        if (v.length > 5) v = v.slice(0,5) + '-' + v.slice(5,8);
        e.target.value = v;
      });
    }

    // =========================
    // WhatsApp (bot√£o fixo)
    // =========================
    function updateWhatsAppBtn(){
      const wa = $('whatsapp-btn');
      const phone = digits(RESTAURANT_WHATSAPP);
      wa.href = phone
        ? `https://wa.me/${phone}?text=${encodeURIComponent("Ol√°! Gostaria de fazer um pedido.")}`
        : `https://wa.me/?text=${encodeURIComponent("Ol√°! Gostaria de fazer um pedido.")}`;
    }
    updateWhatsAppBtn();

    // =========================
    // SUBMIT -> Firestore (/orders) + abre WhatsApp
    // =========================
    $('checkout-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = $('customer-name').value.trim();
      const phone = $('customer-phone').value.trim();
      const cep = $('customer-cep').value.trim();
      const address = $('customer-address').value.trim();
      const neighborhood = $('customer-neighborhood').value.trim();
      const city = $('customer-city').value.trim();
      const complement = $('customer-complement').value.trim();

      if (!cart.length) { alert("Carrinho vazio."); return; }

      const total = cart.reduce((sum, i) => sum + (i.price * i.quantity), 0);

      const orderDoc = {
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp(),
        status: "new",
        customer: {
          name,
          phone,
          addressLine: `${address} ‚Äî ${neighborhood}, ${city} ‚Ä¢ CEP ${cep}${complement ? " ‚Ä¢ " + complement : ""}`
        },
        items: cart.map(i => ({
          name: i.name,
          qty: i.quantity,
          price: i.price,
          emoji: i.emoji || ""
        })),
        total: Number(total)
      };

      await addDoc(collection(db, "orders"), orderDoc);

      // mensagem WhatsApp
      let msg = `üçΩÔ∏è *NOVO PEDIDO*\\n\\n`;
      msg += `üë§ *Cliente:* ${name}\\n`;
      msg += `üì± *Telefone:* ${phone}\\n\\n`;
      msg += `üìç *Endere√ßo:*\\n${orderDoc.customer.addressLine}\\n\\n`;
      msg += `üõí *Itens:*\\n\\n`;
      orderDoc.items.forEach(i => {
        const em = i.emoji || "üçΩÔ∏è";
        msg += `${em} ${i.qty}x ${i.name}\\n`;
        msg += `   R$ ${(i.price * i.qty).toFixed(2)}\\n\\n`;
      });
      msg += `üí∞ *TOTAL: R$ ${orderDoc.total.toFixed(2)}*\\n\\n`;
      msg += `‚è±Ô∏è Tempo estimado: 45min a 1:20h`;

      const restaurantPhone = digits(RESTAURANT_WHATSAPP);
      const waUrl = restaurantPhone
        ? `https://wa.me/${restaurantPhone}?text=${encodeURIComponent(msg)}`
        : `https://wa.me/?text=${encodeURIComponent(msg)}`;

      window.closeCheckout();
      $('success-modal').classList.add('active');

      setTimeout(() => window.open(waUrl, "_blank", "noopener,noreferrer"), 500);

      $('checkout-form').reset();
      cart = [];
      updateCartUI();
    });

    // =========================
    // MENU DIN√ÇMICO: L√™ /products e renderiza por categoria
    // =========================
    const CATEGORY_ORDER = ["Lanches", "Pizzas", "Bebidas", "Sobremesas", "Outros"];

    function categoryIcon(cat){
      const c = (cat||"").toLowerCase();
      if(c.includes("lanche")) return "üçî";
      if(c.includes("pizza")) return "üçï";
      if(c.includes("bebid")) return "ü•§";
      if(c.includes("sobrem")) return "üç∞";
      return "üçΩÔ∏è";
    }

    function renderMenu(products){
      const root = $('menu-root');
      const loading = $('loading');

      const active = products.filter(p => p.isActive !== false); // true por padr√£o

      if(loading) loading.style.display = "none";

      if(!active.length){
        root.innerHTML = `
          <div class="rounded-xl p-6 text-center"
            style="background:#111; border:1px solid #333; color:#fde68a;">
            Nenhum produto ativo ainda. Pe√ßa pro admin ativar produtos no painel.
          </div>
        `;
        return;
      }

      // agrupa por categoria
      const groups = {};
      active.forEach(p => {
        const cat = (p.category || "Outros").trim() || "Outros";
        if(!groups[cat]) groups[cat] = [];
        groups[cat].push(p);
      });

      // ordena categorias
      const cats = Object.keys(groups).sort((a,b) => {
        const ia = CATEGORY_ORDER.indexOf(a);
        const ib = CATEGORY_ORDER.indexOf(b);
        const ra = ia === -1 ? 999 : ia;
        const rb = ib === -1 ? 999 : ib;
        if(ra !== rb) return ra - rb;
        return a.localeCompare(b);
      });

      // ordena produtos (por nome)
      cats.forEach(c => groups[c].sort((x,y) => (x.name||"").localeCompare(y.name||"")));

      root.innerHTML = cats.map(cat => {
        const icon = categoryIcon(cat);
        const items = groups[cat].map(p => {
          const img = p.imageUrl
            ? `<img src="${escapeHtml(p.imageUrl)}" alt="${escapeHtml(p.name||"")}"
                 class="w-16 h-16 rounded-xl object-cover border border-neutral-700" />`
            : `<div class="w-16 h-16 rounded-xl bg-neutral-900 border border-neutral-700 flex items-center justify-center text-2xl">üñºÔ∏è</div>`;

          const em = escapeHtml(p.emoji || icon);
          const price = Number(p.price || 0);

          return `
            <div class="menu-item rounded-xl p-4 flex gap-3"
                 onclick="addToCart('${escapeHtml(p.name||"")}'.replaceAll('&#039;','\\u0027'), ${price}, '${em}'.replaceAll('&#039;','\\u0027'))"
                 style="background:linear-gradient(135deg,#262626 0%,#1f1f1f 100%);border:1px solid #404040;">
              ${img}
              <div class="flex-1">
                <div class="flex items-start justify-between gap-3">
                  <div>
                    <h3 class="font-semibold text-lg" style="color:#fef3c7;">
                      <span class="mr-1">${em}</span>${escapeHtml(p.name||"")}
                    </h3>
                    <p class="text-sm mt-1 opacity-80" style="color:#d6d3d1;">${escapeHtml(p.description||"")}</p>
                    <p class="text-xs mt-2" style="color:#9ca3af;">Clique para adicionar ao carrinho</p>
                  </div>
                  <div class="text-right">
                    <span class="text-2xl font-bold" style="color:#d97706;">${money(price)}</span>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join("");

        return `
          <section class="mb-8">
            <div class="flex items-center gap-3 mb-4 pb-2" style="border-bottom:2px solid #d97706;">
              <span class="text-3xl">${icon}</span>
              <h2 class="text-2xl font-bold" style="color:#d97706;font-family:'Playfair Display',serif;">${escapeHtml(cat)}</h2>
            </div>
            <div class="space-y-3">${items}</div>
          </section>
        `;
      }).join("");
    }

    // realtime products
    onSnapshot(collection(db, "products"), (snap) => {
      const products = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderMenu(products);
    }, (err) => {
      $('loading').style.display = "none";
      $('menu-root').innerHTML = `
        <div class="rounded-xl p-6 text-center"
          style="background:#111; border:1px solid #333; color:#ef4444;">
          Erro ao carregar produtos. Verifique as regras do Firestore para <b>/products</b> (read: true).
        </div>
      `;
    });

    // Init
    updateCartUI();
  </script>
</body>
</html>
